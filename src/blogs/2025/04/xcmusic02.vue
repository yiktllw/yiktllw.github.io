<template>
  <div class="blog-container" ref="container">
    <div class="blog" ref="blog">
      <div class="blog-info">
        <h1 class="blog-title">
          {{ currentBlog?.blogInfo.title ?? "Untitled" }}
        </h1>
      </div>
      <h2
        id="electron-%E7%9A%84%E6%89%93%E5%8C%85%E6%96%B9%E5%BC%8F"
        tabindex="-1"
      >
        Electron çš„æ‰“åŒ…æ–¹å¼
      </h2>
      <p>
        Electron é‡‡ç”¨ Chromium å‰ç«¯ + NodeJS åç«¯ + ç³»ç»Ÿ API çš„æ¶æ„æ¨¡å¼<sup
          class="footnote-ref"
          ><a href="#fn1" id="fnref1">[1]</a></sup
        >ã€‚è½¯ä»¶æ‰“åŒ…åï¼ŒChromium å’Œ NodeJS æ„æˆäº†å­˜å‚¨ç©ºé—´çš„ä¸»è¦éƒ¨åˆ†ã€‚
      </p>
      <p>
        ä»¥ XCMusic çš„ Windows å®‰è£…åŒ…ä¸ºä¾‹ï¼šElectron 10+ æ‰“åŒ…ä½“ç§¯çº¦ 60MBï¼Œå‡çº§è‡³
        Electron 35 åå¢è‡³ 80MBï¼Œè€Œæˆ‘å®é™…ç¼–å†™çš„åº”ç”¨ä»£ç å’Œèµ„æºï¼ˆapp.asarï¼‰ä»…å 
        15MBã€‚
      </p>
      <p>
        è¿™ç§æ‰“åŒ…æœºåˆ¶å­˜åœ¨æ˜¾è‘—å¼Šç«¯ï¼šæ¯ä¸ª Electron åº”ç”¨éƒ½éœ€å†…ç½®å®Œæ•´çš„ Chromium
        è¿è¡Œæ—¶ï¼Œå¯¼è‡´ç”¨æˆ·è®¾å¤‡å¯èƒ½åŒæ—¶å­˜åœ¨æ•°åä¸ªé‡å¤çš„ Chromium å®ä¾‹ã€‚
      </p>
      <p>
        <s>å–œæŠ¥ï¼šçˆ·çš„ç”µè„‘ä¸Šæœ‰ xx ä¸ª Chromium.jpg</s
        ><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>
      </p>
      <h2
        id="%E5%85%BC%E5%AE%B9%E6%80%A7-or-%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4"
        tabindex="-1"
      >
        å…¼å®¹æ€§ OR ç¡¬ç›˜ç©ºé—´
      </h2>
      <p>
        Tauri çš„å®‰è£…åŒ…ä¸åŒ…å« Webview ç»„ä»¶ï¼Œç›´æ¥è°ƒç”¨ç³»ç»ŸåŸç”Ÿ Webview è¿›è¡Œæ¸²æŸ“ï¼š
      </p>
      <blockquote>
        <p>
          <strong>Minimal Size</strong
          ><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>
        </p>
        <p>
          By using the OS's native web rendererï¼Œthe size of a Tauri app can be
          little as 600KB.
        </p>
      </blockquote>
      <p>
        è¿™ç§è®¾è®¡ä½¿å¾— Tauri æ‰“åŒ…åçš„ä½“ç§¯æ˜¯æå°çš„â€”â€”æˆ‘è®¤ä¸ºè¿™æ­£æ˜¯ Tauri
        çš„æ ¸å¿ƒç«äº‰åŠ›æ‰€åœ¨ã€‚
      </p>
      <p>
        ä½†æ˜¯ï¼Œè¿™ç§è®¾è®¡ä¹Ÿæ„å‘³ç€éœ€è¦å¼€å‘è€…é€‚é…ä¸åŒæ“ä½œç³»ç»Ÿçš„ Webview
        ç‰¹æ€§å·®å¼‚ã€‚å¯¹äºä¸ªäººå¼€å‘è€…è€Œè¨€ï¼Œè·¨å¹³å°è°ƒè¯•æ‰€éœ€çš„æ—¶é—´æˆæœ¬æ˜¯ä¸å¾—ä¸è€ƒè™‘çš„é—®é¢˜ã€‚
      </p>
      <p>
        å¦‚åŒ VSCode ä»¥æ€§èƒ½æ¢å–ç”Ÿæ€ä¼˜åŠ¿ï¼ŒElectron ä¸ Tauri
        çš„å–èˆæœ¬è´¨ä¸Šæ˜¯å…¼å®¹æ€§ä¸èµ„æºå ç”¨çš„æƒè¡¡ã€‚
      </p>
      <h2
        id="%E5%86%85%E5%AD%98%E5%AE%89%E5%85%A8...%E5%90%97%3F"
        tabindex="-1"
      >
        å†…å­˜å®‰å…¨...å—?
      </h2>
      <p>Tauri åœ¨å®˜ç½‘ä¸Šå¼ºè°ƒï¼š</p>
      <blockquote>
        <p>
          <strong>Maximum Security</strong>
          <sup class="footnote-ref"><a href="#fn3" id="fnref3:1">[3:1]</a></sup>
        </p>
        <p>
          Front-of-mind for the Tauri Team that drives our highest priorities
          and biggest innovations.
        </p>
      </blockquote>
      <blockquote>
        <p>
          <strong>Powered by Rust</strong>
          <sup class="footnote-ref"><a href="#fn3" id="fnref3:2">[3:2]</a></sup>
        </p>
        <p>
          With performance and security at the center, Rust is the language for
          the next generation of apps.
        </p>
      </blockquote>
      <p>
        ä½œä¸ºå†…å­˜å®‰å…¨çš„ç³»ç»Ÿçº§è¯­è¨€ï¼ŒRust ç¡®å®ä¸ºåç«¯ä»£ç æä¾›äº†å®‰å…¨ä¿éšœã€‚<strong
          ><em>ä½†æ˜¯</em></strong
        >ï¼Œæ­£å¦‚ Tauri åœ¨å…¶å®˜ç½‘ä¸Šå®£ä¼ çš„é‚£æ ·ï¼š
      </p>
      <blockquote>
        <p>
          <strong>Frontend Independent</strong>
          <sup class="footnote-ref"><a href="#fn3" id="fnref3:3">[3:3]</a></sup>
        </p>
        <p>
          Bring your existing web stack to Tauri or start that new dream
          project. Tauri supports any frontend framework so you donâ€™t need to
          change your stack.
        </p>
      </blockquote>
      <p>
        Tauri åªåœ¨åç«¯ä½¿ç”¨äº† Rustï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•è¯­è¨€ç¼–å†™å‰ç«¯ï¼šä½¿ç”¨ Rust çš„
        Dioxusã€Yewï¼›ä½¿ç”¨ JS çš„ Vue, React ç­‰ã€‚
      </p>
      <p>
        åœ¨ XCMusic ä¸­ï¼ŒElectron åç«¯ä»£ç ä»… 1200 è¡Œï¼Œè€ŒåŸºäº Vue çš„å‰ç«¯ä»£ç é«˜è¾¾
        2.6w è¡Œã€‚è¿™æ„å‘³ç€å³ä½¿è¿ç§»è‡³ Tauriï¼Œä»…æœ‰ 4% çš„ä»£ç èƒ½äº«å— Rust
        çš„å†…å­˜å®‰å…¨ä¼˜åŠ¿ã€‚
      </p>
      <p>
        åœ¨ XCMusic ä¸­ï¼šTauri ä¸»è¿›ç¨‹å†…å­˜å ç”¨æ§åˆ¶åœ¨ 10MB ä»¥å†…ï¼Œä½† Windows Webview
        è¿›ç¨‹å†…å­˜æ¶ˆè€—çº¦ 300MBâ€”â€”ä¸ Electron æ¸²æŸ“è¿›ç¨‹çš„å ç”¨æ°´å¹³åŸºæœ¬æŒå¹³ã€‚
      </p>
      <p>
        ç”±æ­¤å¯è§ï¼Œä¸ºè·å¾—æœ‰é™çš„å®‰å…¨æå‡è€ŒæŠ›å¼ƒ Electron
        çš„å…¼å®¹æ€§å’Œç”Ÿæ€ä¼˜åŠ¿ï¼Œå…¶æ€§ä»·æ¯”å€¼å¾—å•†æ¦·ã€‚
      </p>
      <h2 id="%E7%BB%93%E8%AE%BA" tabindex="-1">ç»“è®º</h2>
      <p>
        å¯¹äºå…¨æ–°å¼€å‘çš„ Windows æ¡Œé¢åº”ç”¨ï¼Œé‡‡ç”¨ Tauri é…åˆ Rust å‰ç«¯æ¡†æ¶ï¼ˆå¦‚
        Dioxus/Yewï¼‰æ˜¯å€¼å¾—è€ƒè™‘çš„æ–¹æ¡ˆã€‚
      </p>
      <p>
        ç„¶è€Œå°± XCMusic è€Œè¨€ï¼Œä½œä¸ºè·¨å¹³å° Vue åº”ç”¨ï¼Œè¿ç§»è‡³ Tauri
        éš¾ä»¥è·å¾—æ˜¾è‘—çš„å®‰å…¨å¢ç›Šï¼Œæ˜¯è´¹åŠ›ä¸è®¨å¥½çš„ã€‚
      </p>
      <hr class="footnotes-sep" />
      <section class="footnotes">
        <ol class="footnotes-list">
          <li id="fn1" class="footnote-item">
            <p>
              <a href="https://www.electronjs.org/zh/docs/latest/"
                >ç®€ä»‹ï¼šElectron</a
              >
              <a href="#fnref1" class="footnote-backref">â†©ï¸</a>
            </p>
          </li>
          <li id="fn2" class="footnote-item">
            <p>
              <a href="https://github.com/xh321/CefDetector.Net"
                >GitHubï¼šæ£€æµ‹ç”µè„‘ä¸­æœ‰å¤šå°‘ä¸ª Chromium å†…æ ¸çš„ç¨‹åº</a
              >
              <a href="#fnref2" class="footnote-backref">â†©ï¸</a>
            </p>
          </li>
          <li id="fn3" class="footnote-item">
            <p>
              <a href="https://v2.tauri.app/">Tauri 2.0 å®˜æ–¹ç½‘ç«™</a>
              <a href="#fnref3" class="footnote-backref">â†©ï¸</a>
              <a href="#fnref3:1" class="footnote-backref">â†©ï¸</a>
              <a href="#fnref3:2" class="footnote-backref">â†©ï¸</a>
              <a href="#fnref3:3" class="footnote-backref">â†©ï¸</a>
            </p>
          </li>
        </ol>
      </section>
    </div>
    <div class="sidebar-placeholder">
      <div class="sidebar-container">
        <div class="nav">
          <div
            class="nav-item selected"
            id="nav_article"
            @click="nav_to('article')"
          >
            æ–‡ç« ä¿¡æ¯
          </div>
          <div class="nav-item" id="nav_site" @click="nav_to('site')">
            ç«™ç‚¹æ¦‚è§ˆ
          </div>
        </div>
        <div class="nav-content">
          <div class="article toc active" id="article">
            <div class="toc-title">ç›®å½•</div>
            <div class="progress-bar" />
            <ul class="depth-0">
              <li>
                <a
                  href="#electron-%E7%9A%84%E6%89%93%E5%8C%85%E6%96%B9%E5%BC%8F"
                  :class="0 === current_heading ? 'active' : 'not-active'"
                  >1&nbsp;Electron çš„æ‰“åŒ…æ–¹å¼</a
                >
              </li>
              <li>
                <a
                  href="#%E5%85%BC%E5%AE%B9%E6%80%A7-or-%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4"
                  :class="1 === current_heading ? 'active' : 'not-active'"
                  >2&nbsp;å…¼å®¹æ€§ OR ç¡¬ç›˜ç©ºé—´</a
                >
              </li>
              <li>
                <a
                  href="#%E5%86%85%E5%AD%98%E5%AE%89%E5%85%A8...%E5%90%97%3F"
                  :class="2 === current_heading ? 'active' : 'not-active'"
                  >3&nbsp;å†…å­˜å®‰å…¨...å—?</a
                >
              </li>
              <li>
                <a
                  href="#%E7%BB%93%E8%AE%BA"
                  :class="3 === current_heading ? 'active' : 'not-active'"
                  >4&nbsp;ç»“è®º</a
                >
              </li>
            </ul>
            <div class="info">
              <span class="create-time">
                <span class="ele-title">åˆ›å»ºäºï¼š</span
                >{{
                  formatTime_yyyy_mm_dd_hh_mm(
                    currentBlog?.blogInfo.createTime ?? 0,
                  )
                }}
              </span>
              <span class="last-update">
                <span class="ele-title">ä¿®æ”¹äºï¼š</span
                >{{
                  formatTime_yyyy_mm_dd_hh_mm(
                    currentBlog?.blogInfo.lastUpdate ?? 0,
                  )
                }}
              </span>
              <span class="word-count">
                <span class="ele-title">æœ¬æ–‡å­—æ•°ï¼š</span
                >{{ currentBlog?.blogInfo.wordCount }}å­—
              </span>
              <span class="reading-time">
                <span class="ele-title">é¢„è®¡é˜…è¯»æ—¶é—´ï¼š</span
                >{{ currentBlog?.blogInfo.readingTime }}åˆ†é’Ÿ
              </span>
              <span
                class="category"
                v-if="currentBlog?.blogInfo.category !== 'default'"
              >
                <span class="ele-title">åˆ†ç±»äºï¼š</span
                >{{ currentBlog?.blogInfo.category }}
              </span>
              <span class="series" v-if="currentBlog?.blogInfo.series.enable">
                <span class="ele-title">ç³»åˆ—ï¼š</span
                >{{ currentBlog?.blogInfo.series.name }}
              </span>
              <span class="copy-right">
                <span class="ele-title">è®¸å¯åè®®ï¼š</span>
                <p xmlns:cc="http://creativecommons.org/ns#">
                  <a
                    href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1"
                    target="_blank"
                    rel="license noopener noreferrer"
                    style="display: inline-block"
                    >CC BY-NC-SA 4.0</a
                  >
                </p>
              </span>
              <span
                class="tags"
                v-if="currentBlog && currentBlog.blogInfo.tags.length > 0"
              >
                <span class="ele-title">æ ‡ç­¾ï¼š</span>
                <span
                  v-for="tag in currentBlog?.blogInfo.tags"
                  class="tag"
                  :key="tag"
                  >{{ tag }}</span
                >
              </span>
            </div>
          </div>
          <div class="site" id="site">æ ‡ç­¾2çš„å†…å®¹</div>
        </div>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
import { ref, nextTick, onUnmounted } from "vue";
// @ts-ignore
import copy_svg from "@/assets/svg/copy.svg";
import blogs from "@/blogs.json";
import { formatTime_yyyy_mm_dd_hh_mm } from "@/utils/time";

const blog = ref<HTMLElement>();
const heading_offset_top = ref<number[]>([]);
const current_heading = ref<number>(0);
const handleScroll = () => {
  const scrollTop =
    (document.documentElement.scrollTop || document.body.scrollTop) + 100;
  let _index = 0;
  for (const [index, item] of heading_offset_top.value.entries()) {
    if (scrollTop > item) {
      if (
        heading_offset_top.value[index + 1] &&
        scrollTop < heading_offset_top.value[index + 1]
      ) {
        _index = index;
        break;
      } else if (index === heading_offset_top.value.length - 1) {
        _index = index;
      }
    }
  }
  if (_index !== current_heading.value) current_heading.value = _index;
};
nextTick(() => {
  const headings = document.querySelectorAll(
    ".blog h2, .blog h3, .blog h4, .blog h5, .blog h6",
  ) as NodeListOf<HTMLElement>;
  headings.forEach((heading) => {
    heading_offset_top.value.push(heading.offsetTop);
  });
  heading_offset_top.value.map((a) => -a);
  heading_offset_top.value.sort((a, b) => a - b);
  document.addEventListener("scroll", handleScroll);
});
onUnmounted(() => {
  document.removeEventListener("scroll", handleScroll);
});

const nav_to = (id: "article" | "site") => {
  const content = document.getElementById(id);
  const content_to_be_hidden = document.getElementById(
    id === "article" ? "site" : "article",
  );

  if (content_to_be_hidden) {
    content_to_be_hidden.classList.remove("active");
    if (content) {
      content.style.display = "block";
      content.style.position = "absolute";
    }
    setTimeout(() => {
      if (content) {
        content.classList.add("active");
        content.style.position = "initial";
      }
      content_to_be_hidden.style.display = "none";
    }, 200);
  } else {
    if (content) content.classList.add("active");
  }

  const selected = document.getElementById("nav_" + id);
  const unselected = document.getElementById(
    "nav_" + (id === "article" ? "site" : "article"),
  );

  if (selected) selected.classList.add("selected");
  if (unselected) unselected.classList.remove("selected");
};

const utteranc = document.createElement("script");
utteranc.src = "https://utteranc.es/client.js";
utteranc.setAttribute("repo", import.meta.env.VITE_COMMENT_REPO);
utteranc.setAttribute("issue-term", "2025/04/xcmusic02");
utteranc.setAttribute("label", "ğŸ’¬comment");
utteranc.setAttribute("theme", `github-${window.theme ?? "dark"}`);
utteranc.setAttribute("crossorigin", "anonymous");
utteranc.setAttribute("async", "true");
nextTick(() => {
  blog.value?.appendChild(utteranc);
  // setTimeout(() => {
  window.mermaid?.initialize({
    startOnLoad: false,
    theme: window.theme === "dark" ? "dark" : "default",
  });
  window.mermaid?.run();
  // }, 1000);
});

const currentBlog = blogs.find(
  (item) => item.component === "@/blogs/2025/04/xcmusic02.vue",
);
document.title = currentBlog?.blogInfo.title ?? "yiktllwçš„åšå®¢";

// @ts-ignore
const codeToCopy = [];
// @ts-ignore
const copyCode = (index: number) => {
  // @ts-ignore
  const code = codeToCopy[index];
  navigator.clipboard.writeText(code);
};

const codeOpen = ref<boolean[]>([]);
// @ts-ignore
const toggleCodeOpen = (index: number) => {
  codeOpen.value[index] = !codeOpen.value[index];
};
</script>
