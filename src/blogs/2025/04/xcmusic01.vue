<template>
  <div class="blog" ref="blog">
    <div class="blog-info">
      <h1 class="blog-title">
        {{ currentBlog?.blogInfo.title ?? "Untitled" }}
      </h1>
      <div class="info">
        <span class="create-time">
          <span class="ele-title">å‘å¸ƒäºï¼š</span
          >{{
            formatTime_yyyy_mm_dd_hh_mm(currentBlog?.blogInfo.createTime ?? 0)
          }}
        </span>
        <span class="last-update">
          <span class="ele-title">ä¿®æ”¹äºï¼š</span
          >{{
            formatTime_yyyy_mm_dd_hh_mm(currentBlog?.blogInfo.lastUpdate ?? 0)
          }}
        </span>
        <span class="reading-time">
          <span class="ele-title">é˜…è¯»æ—¶é•¿ï¼š</span
          >{{ currentBlog?.blogInfo.readingTime }}åˆ†é’Ÿ
        </span>
        <span
          class="category"
          v-if="currentBlog?.blogInfo.category !== 'default'"
        >
          <span class="ele-title">åˆ†ç±»ï¼š</span
          >{{ currentBlog?.blogInfo.category }}
        </span>
        <span class="series" v-if="currentBlog?.blogInfo.series.enable">
          <span class="ele-title">ç³»åˆ—ï¼š</span
          >{{ currentBlog?.blogInfo.series.name }}
        </span>
        <span class="copy-right">
          <span class="ele-title">è®¸å¯åè®®ï¼š</span>
          <p xmlns:cc="http://creativecommons.org/ns#">
            <a
              href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1"
              target="_blank"
              rel="license noopener noreferrer"
              style="display: inline-block"
              >CC BY-NC-SA 4.0<img
                style="
                  height: 22px !important;
                  margin-left: 3px;
                  vertical-align: text-bottom;
                "
                src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"
                alt="" /><img
                style="
                  height: 22px !important;
                  margin-left: 3px;
                  vertical-align: text-bottom;
                "
                src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"
                alt="" /><img
                style="
                  height: 22px !important;
                  margin-left: 3px;
                  vertical-align: text-bottom;
                "
                src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"
                alt="" /><img
                style="
                  height: 22px !important;
                  margin-left: 3px;
                  vertical-align: text-bottom;
                "
                src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"
                alt=""
            /></a>
          </p>
        </span>
      </div>
    </div>
    <p>
      ç½‘æ˜“äº‘éŸ³ä¹çš„æ­Œè¯apiè¿”å›çš„æ­Œè¯ç±»å‹æœ‰ä¸¤ç§ï¼šé€è¡Œæ­Œè¯ï¼ˆlrcï¼‰å’Œé€å­—æ­Œè¯ï¼ˆyrcï¼‰ã€‚
    </p>
    <h2 id="%E7%9B%AE%E6%A0%87" tabindex="-1">ç›®æ ‡</h2>
    <p>éœ€è¦å®ç°çš„æ­Œè¯åŠ¨ç”»åŒ…æ‹¬ï¼š</p>
    <ol>
      <li>æ»šåŠ¨åŠ¨ç”»ï¼šå¹³æ»‘æ»šåŠ¨åˆ°å½“å‰è¡Œ</li>
      <li>ç¼©æ”¾åŠ¨ç”»ï¼šå½“å‰è¡Œçš„ç¼©æ”¾ä»1.0ç¼“å˜ä¸º1.3ï¼Œä¸Šä¸€è¡Œåå‘å˜åŒ–</li>
      <li>é€å­—æ­Œè¯åŠ¨ç”»ï¼šä»å·¦åˆ°å³çš„å‰ªåˆ‡æ•ˆæœ</li>
    </ol>
    <p>é€è¡Œæ­Œè¯å¯è§†ä¸ºé€å­—æ­Œè¯çš„ç‰¹ä¾‹ï¼šå³åŠ¨ç”»é•¿åº¦ä¸º0çš„é€å­—æ­Œè¯ã€‚</p>
    <h2
      id="%E5%88%9D%E4%BB%A3%E6%96%B9%E6%A1%88%EF%BC%9A%E5%9F%BA%E4%BA%8Ecss%E5%8A%A8%E7%94%BB%E7%9A%84%E5%AE%9E%E7%8E%B0"
      tabindex="-1"
    >
      åˆä»£æ–¹æ¡ˆï¼šåŸºäºCSSåŠ¨ç”»çš„å®ç°
    </h2>
    <p>
      åˆç‰ˆåº”ç”¨äºXCMusic
      <a href="https://github.com/yiktllw/XCMusic/releases/tag/0.2.4">0.2.4</a
      >åŠä¹‹å‰ç‰ˆæœ¬ã€‚
    </p>
    <p>ä¸»è¦åŸç†æ˜¯ï¼š</p>
    <ol>
      <li>ç”¨<code>requestAnimationFrame</code>è®¡ç®—æ»šåŠ¨åŠ¨ç”»ä½ç½®</li>
      <li>CSSåŠ¨ç”»å¤„ç†ç¼©æ”¾æ•ˆæœï¼›</li>
      <li><code>clip-path</code>å®ç°é€å­—åŠ¨ç”»ï¼ŒåŠ¨ç”»æ—¶é•¿å¯¹åº”æ­Œè¯æ—¶é—´</li>
    </ol>
    <pre><code :data-open="codeOpen[0]" class="hljs language-vue" style="font-family: yiktllw-code, serif; position: relative;"><div class="line-numbers"><span v-for="i in 15">{{ i }}</span></div><div class="top-line"><div @click="toggleCodeOpen(0)" class="language">vue</div><div class="copy-button" @click="copyCode(0)"><img class="copy-img" :src="copy_svg"/></div></div><div class="code"><span class="language-xml"><span class="hljs-comment">&lt;!-- é€å­—æ­Œè¯åŠ¨ç”» --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">span</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item-white font-color-main&quot;</span>
  <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;{
    transition: `clip-path ${(word.duration ?? 0) + (word.startTime ?? line.startTime) &gt; currentTime ? (word.duration ?? 0) / 1000 : 0}s linear, color 0.5s ease`,
    clipPath:
      word.startTime &lt;= currentTime ? &#x27;inset(0 0% 0 0)&#x27; : &#x27;inset(0 100% 0 0)&#x27;,
    color:
      index === currentLine
        ? &#x27;var(--font-color-main)&#x27;
        : &#x27;var(--font-color-standard)&#x27;,
  }&quot;</span>
&gt;</span>
  &lbrace;&lbrace; word.text &rbrace;&rbrace;
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
</span></div></code></pre>
    <h2
      id="%E4%BA%8C%E4%BB%A3%E6%96%B9%E6%A1%88%EF%BC%9A%E4%BD%BF%E7%94%A8canvas%E7%BB%98%E5%88%B6%E6%AD%8C%E8%AF%8D"
      tabindex="-1"
    >
      äºŒä»£æ–¹æ¡ˆï¼šä½¿ç”¨Canvasç»˜åˆ¶æ­Œè¯
    </h2>
    <p>
      åº”ç”¨äºXCMusic
      <a href="https://github.com/yiktllw/XCMusic/releases/tag/0.2.5">0.2.5</a
      >è‡³<a href="https://github.com/yiktllw/XCMusic/releases/tag/0.3.0"
        >0.3.0</a
      >ç‰ˆæœ¬ã€‚
    </p>
    <p>åœ¨ç¬¬ä¸€ç‰ˆæ­Œè¯ä¸­ï¼Œæˆ‘å‘ç°å…¶å­˜åœ¨è¯¸å¤šä¸ä¾¿åˆ©æ€§ï¼š</p>
    <ol>
      <li>CSSåŠ¨ç”»æ— æ³•æš‚åœ</li>
      <li>è¿‡å¤šçš„domå…ƒç´ å¯¼è‡´çš„å†…å­˜å ç”¨é—®é¢˜</li>
      <li>CSSåŠ¨ç”»çš„è‡ªç”±æ€§å¤ªä½</li>
    </ol>
    <p>æ°å¥½Canvasèƒ½å¤Ÿå®Œç¾è§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p>
    <p>ä½¿ç”¨Canvaså®Œæˆæ­Œè¯çš„é€»è¾‘ï¼š</p>
    <ol>
      <li>è·å–å½“å‰ç³»ç»Ÿç¼©æ”¾å’Œåº”ç”¨ç¼©æ”¾å¹¶é€‚é…ï¼Œé˜²æ­¢Canvasæ¨¡ç³Š</li>
      <li>æ ¹æ®è§£æåçš„æ­Œè¯ï¼Œè®¡ç®—æ¯ä¸€è¡Œæ­Œè¯çš„ä½ç½®ã€‚</li>
      <li>
        ä½¿ç”¨requestAnimationFrameåœ¨æ¯ä¸€å¸§å®Œæˆï¼š
        <ul>
          <li>è·å–å½“å‰éŸ³é¢‘çš„æ’­æ”¾è¿›åº¦</li>
          <li>è®¡ç®—å½“å‰æ»šåŠ¨é«˜åº¦ï¼Œå®ç°æ»šåŠ¨åŠ¨ç”»</li>
          <li>æ ¹æ®æ»šåŠ¨é«˜åº¦ä¸å½“å‰è¡Œé«˜åº¦çš„å·®å€¼ï¼Œè®¡ç®—ç¼©æ”¾åŠ¨ç”»å’Œå­—ä½“é¢œè‰²</li>
          <li>
            è®¡ç®—å½“å‰é€å­—åŠ¨ç”»ä½ç½®ï¼Œå¹¶è®¡ç®—<code>cutX</code>çš„ä½ç½®ã€‚<br />
            ä¸ç¬¬ä¸€ç‰ˆæ­Œè¯ç±»ä¼¼ï¼Œåœ¨<code>scrollY</code>å¤„ç”»ä¸¤ä»½æ­Œè¯ï¼šä¸€ä»½ä¸ºç™½è‰²ï¼Œä»…æ˜¾ç¤º<code>cutX</code>å·¦ä¾§çš„éƒ¨åˆ†ï¼›å¦ä¸€ä»½ä¸ºç°è‰²ï¼Œä»…æ˜¾ç¤º<code>cutX</code>å³ä¾§çš„éƒ¨åˆ†ã€‚
          </li>
        </ul>
      </li>
      <li>ç›‘å¬ç”¨æˆ·é¼ æ ‡æ»šè½®ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„æ»šåŠ¨åŠ¨ç”»ã€‚</li>
    </ol>
    <p>çº¯jså®ç°å¸¦æ¥çš„è‡ªç”±åº¦æ˜¯æé«˜çš„--è¿™ä¸€ç‰ˆåŠ¨ç”»çš„æ•ˆæœä¹Ÿæ˜¯æœ€å¥½çš„ã€‚</p>
    <h2
      id="%E6%9C%80%E7%BB%88%E7%89%88%E6%9C%AC%EF%BC%9A%E5%9F%BA%E4%BA%8Eweb-animations-api%E5%92%8Ccss%E7%9A%84%E6%AD%8C%E8%AF%8D%E5%8A%A8%E7%94%BB"
      tabindex="-1"
    >
      æœ€ç»ˆç‰ˆæœ¬ï¼šåŸºäºWeb Animations APIå’ŒCSSçš„æ­Œè¯åŠ¨ç”»
    </h2>
    <p>æœ€ç»ˆç‰ˆæ­Œè¯åŠ¨ç”»ï¼Œåœ¨XCMusic 0.3.1ï¼ˆæœªå‘å¸ƒï¼‰åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚</p>
    <p>åœ¨ç‰ˆæœ¬è¿­ä»£ä¸­,æˆ‘å‘ç°ä½¿ç”¨Canvasç»˜åˆ¶æ­Œè¯å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
    <ol>
      <li>
        åœ¨ä½¿ç”¨æ­Œè¯æ—¶ï¼Œelectronçš„GPUè¿›ç¨‹å ç”¨çš„å†…å­˜ä¼šé€æ­¥ä¸Šæ¶¨ï¼Œå¤§çº¦åœ¨ä¸€æ•´å¤©å†…ä»10MBä»¥å†…ä¸Šæ¶¨åˆ°100MBå·¦å³ã€‚è€Œelectronæ²¡æœ‰æä¾›apiæ¥æ¸…é™¤GPUè¿›ç¨‹çš„å†…å­˜å ç”¨
      </li>
      <li>
        æ”¾å¼ƒä½¿ç”¨DOMçš„åŒæ—¶ä¹Ÿæ”¾å¼ƒäº†ç°æœ‰çš„æ»šåŠ¨å®¹å™¨å’Œæ’ç‰ˆç³»ç»Ÿã€‚å‰è€…å¯¼è‡´æ­Œè¯çš„æ»šåŠ¨äº¤äº’ä½“éªŒå˜å·®ï¼Œè€Œåè€…æ„å‘³ç€é•¿è¡Œæ­Œè¯çš„æ’ç‰ˆæˆä¸ºä¸€ä¸ªå¤§é—®é¢˜
      </li>
      <li>
        ç”±äºéœ€è¦åœ¨æ¯ä¸€å¸§è®¡ç®—åŠ¨ç”»ï¼Œæ€§èƒ½ä¼˜åŒ–æ ¼å¤–é‡è¦ã€‚è¿™å¤§å¤§é™åˆ¶äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå¢å¤§äº†ç»´æŠ¤éš¾åº¦
      </li>
      <li>ç”»å¸ƒå¤§å°ä¸çµæ´»,æ— æ³•åŠ¨æ€é€‚åº”å¸ƒå±€æ”¹å˜</li>
    </ol>
    <p>
      Web Animations Apiå¯ä»¥åœ¨jsä¸­æ“æ§CSSåŠ¨ç”»,
      è§£å†³äº†åˆä»£æ–¹æ¡ˆä¸­åŠ¨ç”»çµæ´»æ€§çš„é—®é¢˜ã€‚
    </p>
    <p>
      è‡³äºå†…å­˜å ç”¨é—®é¢˜, åœ¨åŠ è½½100å¥æ­Œè¯<sup class="footnote-ref"
        ><a href="#fn1" id="fnref1">[1]</a></sup
      >
      (å¸¦ç¿»è¯‘)å,
      æ¸²æŸ“è¿›ç¨‹å†…å­˜å ç”¨ä»…å¢åŠ äº†5MBã€‚å¹¶ä¸”è¿™éƒ¨åˆ†å†…å­˜æ˜¯èƒ½å¤Ÿç¨³å®šå¾—åˆ°é‡Šæ”¾çš„ã€‚
    </p>
    <p>ä½¿ç”¨Web Animations Apiå®Œæˆæ­Œè¯åŠ¨ç”»çš„åŸºæœ¬è¿‡ç¨‹ä¸ºï¼š</p>
    <ol>
      <li>
        åœ¨è·å–é€å­—æ­Œè¯å,
        è°ƒç”¨<code>computeLyricsElements()</code>å‡½æ•°ï¼šè¿™ä¸ªå‡½æ•°ä¼šå®Œæˆï¼š
        <ul>
          <li>ç”Ÿæˆæ­Œè¯å¯¹åº”çš„domå…ƒç´ , å¹¶ä¿å­˜domå…ƒç´ çš„å¼•ç”¨</li>
          <li>ä¸ºè¡Œå…ƒç´ æ·»åŠ è¡ŒåŠ¨ç”»(ç¼©æ”¾åŠ¨ç”»)</li>
          <li>ä¸ºè¯å…ƒç´ æ·»åŠ ä»å·¦åˆ°å³çš„å‰ªåˆ‡åŠ¨ç”»</li>
          <li>æš‚åœæ‰€æœ‰åŠ¨ç”», å¹¶ä¿å­˜åŠ¨ç”»çš„å¼•ç”¨</li>
        </ul>
      </li>
      <li>åŒæ—¶, ä»é€å­—æ­Œè¯ç”Ÿæˆæ—¶é—´çº¿</li>
      <li>
        ä½¿ç”¨<code>requestAnimationFrame()</code>å‡½æ•°, åœ¨æ¯ä¸€å¸§ç›‘å¬æ’­æ”¾è¿›åº¦,
        å¹¶é€šè¿‡æ—¶é—´çº¿è®¡ç®—æ˜¯å¦æœ‰éœ€è¦æ’­æ”¾çš„åŠ¨ç”»
      </li>
      <li>éœ€è¦æ’­æ”¾åŠ¨ç”»æ—¶, è°ƒç”¨<code>animate.play()</code>æ¥æ’­æ”¾åŠ¨ç”»ã€‚</li>
    </ol>
    <pre><code :data-open="codeOpen[1]" class="hljs language-typescript" style="font-family: yiktllw-code, serif; position: relative;"><div class="line-numbers"><span v-for="i in 64">{{ i }}</span></div><div class="top-line"><div @click="toggleCodeOpen(1)" class="language">typescript</div><div class="copy-button" @click="copyCode(1)"><img class="copy-img" :src="copy_svg"/></div></div><div class="code"><span class="hljs-comment">/** è®¡ç®—æ­Œè¯domå’ŒåŠ¨ç”» */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">computeLyricsElements</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-comment">// æ¸…ç©ºåŸæœ‰çš„å…ƒç´ å’ŒåŠ¨ç”»</span>
  <span class="hljs-comment">// çœç•¥æ¸…ç†ä»£ç </span>

  <span class="hljs-comment">// ç”Ÿæˆæ–°çš„å…ƒç´ ï¼Œå¹¶è®¡ç®—åŠ¨ç”»</span>
  animations.<span class="hljs-property">value</span> = lyrics.<span class="hljs-property">value</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function">(<span class="hljs-params">line, lineIndex</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> lineKeyframes = [
      { <span class="hljs-attr">transform</span>: <span class="hljs-string">&quot;scale(1)&quot;</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span> },
      { <span class="hljs-attr">transform</span>: <span class="hljs-string">&quot;scale(1.3)&quot;</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span> },
    ];
    <span class="hljs-keyword">const</span> _lineKeyframes = [
      { <span class="hljs-attr">transform</span>: <span class="hljs-string">&quot;scale(1)&quot;</span> },
      { <span class="hljs-attr">transform</span>: <span class="hljs-string">&quot;scale(1.3)&quot;</span> },
    ];
    <span class="hljs-keyword">const</span> <span class="hljs-attr">lineOptions</span>: <span class="hljs-title class_">KeyframeAnimationOptions</span> = {
      <span class="hljs-attr">duration</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">easing</span>: <span class="hljs-string">&quot;ease-out&quot;</span>,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">&quot;forwards&quot;</span>,
    };

    <span class="hljs-comment">// ç”Ÿæˆè¡Œå…ƒç´ </span>
    <span class="hljs-keyword">const</span> lineElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);
    lineElement.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;lyrics-new-line&quot;</span>;
    lineElement.<span class="hljs-property">style</span>.<span class="hljs-property">transformOrigin</span> = <span class="hljs-string">&quot;left center&quot;</span>;
    container.<span class="hljs-property">value</span>?.<span class="hljs-title function_">appendChild</span>(lineElement);
    lineElements.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(lineElement);

    <span class="hljs-comment">// ç”Ÿæˆè¡ŒåŠ¨ç”»</span>
    <span class="hljs-keyword">const</span> lineAnimation = lineElement.<span class="hljs-title function_">animate</span>(lineKeyframes, lineOptions);
    lineAnimation.<span class="hljs-title function_">pause</span>();
    lineAnimations.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(lineAnimation);

    <span class="hljs-comment">// ç”ŸæˆèƒŒæ™¯è¡Œå…ƒç´ </span>
    <span class="hljs-comment">// ç”ŸæˆèƒŒæ™¯è¡ŒåŠ¨ç”»</span>
    <span class="hljs-comment">// ç”Ÿæˆç¿»è¯‘è¡Œå…ƒç´ </span>
    <span class="hljs-comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>

    <span class="hljs-comment">// è¿”å›é€å­—åŠ¨ç”»</span>
    <span class="hljs-keyword">return</span> line.<span class="hljs-property">words</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">word</span>) =&gt;</span> {
      <span class="hljs-comment">// ç”Ÿæˆé€å­—å…ƒç´ </span>
      <span class="hljs-keyword">const</span> wordElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;span&quot;</span>);
      wordElement.<span class="hljs-property">innerText</span> = word.<span class="hljs-property">text</span>;
      lineElement.<span class="hljs-title function_">appendChild</span>(wordElement);

      <span class="hljs-comment">// ç”Ÿæˆé€å­—èƒŒæ™¯å…ƒç´ </span>
      <span class="hljs-comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>

      <span class="hljs-comment">// ç”Ÿæˆé€å­—åŠ¨ç”»</span>
      <span class="hljs-keyword">const</span> animateKeyframes = [
        { <span class="hljs-attr">clipPath</span>: <span class="hljs-string">&quot;inset(0 100% 0 0)&quot;</span> },
        { <span class="hljs-attr">clipPath</span>: <span class="hljs-string">&quot;inset(0 0 0 0)&quot;</span> },
      ];
      <span class="hljs-keyword">const</span> animate = wordElement.<span class="hljs-title function_">animate</span>(animateKeyframes, {
        <span class="hljs-attr">duration</span>: word.<span class="hljs-property">duration</span>.<span class="hljs-property">ms</span> || <span class="hljs-number">1</span>,
        <span class="hljs-attr">easing</span>: <span class="hljs-string">&quot;linear&quot;</span>,
        <span class="hljs-attr">fill</span>: <span class="hljs-string">&quot;backwards&quot;</span>,
      });
      animate.<span class="hljs-title function_">pause</span>();

      <span class="hljs-keyword">return</span> animate;
    });
  });
};
</div></code></pre>
    <hr class="footnotes-sep" />
    <section class="footnotes">
      <ol class="footnotes-list">
        <li id="fn1" class="footnote-item">
          <p>
            <a href="https://music.163.com/song?id=22256832"
              >è´å¤šèŠ¬ç¬¬ä¹äº¤å“æ›²ã€‚å¯Œç‰¹æ–‡æ ¼å‹’ / 1951å¹´æ‹œç½—ä¼Šç‰¹éŸ³ä¹èŠ‚,
              ç½‘æ˜“äº‘éŸ³ä¹id:22256832</a
            >
            <a href="#fnref1" class="footnote-backref">â†©ï¸</a>
          </p>
        </li>
      </ol>
    </section>
  </div>
</template>
<script setup lang="ts">
import { ref, nextTick } from "vue";
import copy_svg from "@/assets/svg/copy.svg";
import blogs from "@/blogs.json";
import { formatTime_yyyy_mm_dd_hh_mm } from "@/utils/time";

const blog = ref<HTMLElement>();

const utteranc = document.createElement("script");
utteranc.src = "https://utteranc.es/client.js";
utteranc.setAttribute("repo", import.meta.env.VITE_COMMENT_REPO);
utteranc.setAttribute("issue-term", "2025/04/xcmusic01");
utteranc.setAttribute("label", "ğŸ’¬comment");
utteranc.setAttribute("theme", `github-${window.theme ?? "dark"}`);
utteranc.setAttribute("crossorigin", "anonymous");
utteranc.setAttribute("async", "true");
nextTick(() => {
  blog.value?.appendChild(utteranc);
  // setTimeout(() => {
  window.mermaid?.initialize({
    startOnLoad: false,
    theme: window.theme === "dark" ? "dark" : "default",
  });
  window.mermaid?.run();
  // }, 1000);
});

const currentBlog = blogs.find(
  (item) => item.component === "@/blogs/2025/04/xcmusic01.vue",
);
document.title = currentBlog?.blogInfo.title ?? "yiktllwçš„åšå®¢";

const codeToCopy = [
  "<!-- é€å­—æ­Œè¯åŠ¨ç”» -->\n<span\n  class=\"item-white font-color-main\"\n  :style=\"{\n    transition: `clip-path ${(word.duration ?? 0) + (word.startTime ?? line.startTime) > currentTime ? (word.duration ?? 0) / 1000 : 0}s linear, color 0.5s ease`,\n    clipPath:\n      word.startTime <= currentTime ? 'inset(0 0% 0 0)' : 'inset(0 100% 0 0)',\n    color:\n      index === currentLine\n        ? 'var(--font-color-main)'\n        : 'var(--font-color-standard)',\n  }\"\n>\n  {{ word.text }}\n</span>\n",
  '/** è®¡ç®—æ­Œè¯domå’ŒåŠ¨ç”» */\nconst computeLyricsElements = () => {\n  // æ¸…ç©ºåŸæœ‰çš„å…ƒç´ å’ŒåŠ¨ç”»\n  // çœç•¥æ¸…ç†ä»£ç \n\n  // ç”Ÿæˆæ–°çš„å…ƒç´ ï¼Œå¹¶è®¡ç®—åŠ¨ç”»\n  animations.value = lyrics.value.flatMap((line, lineIndex) => {\n    const lineKeyframes = [\n      { transform: "scale(1)", opacity: 0 },\n      { transform: "scale(1.3)", opacity: 1 },\n    ];\n    const _lineKeyframes = [\n      { transform: "scale(1)" },\n      { transform: "scale(1.3)" },\n    ];\n    const lineOptions: KeyframeAnimationOptions = {\n      duration: 200,\n      easing: "ease-out",\n      fill: "forwards",\n    };\n\n    // ç”Ÿæˆè¡Œå…ƒç´ \n    const lineElement = document.createElement("div");\n    lineElement.className = "lyrics-new-line";\n    lineElement.style.transformOrigin = "left center";\n    container.value?.appendChild(lineElement);\n    lineElements.value.push(lineElement);\n\n    // ç”Ÿæˆè¡ŒåŠ¨ç”»\n    const lineAnimation = lineElement.animate(lineKeyframes, lineOptions);\n    lineAnimation.pause();\n    lineAnimations.value.push(lineAnimation);\n\n    // ç”ŸæˆèƒŒæ™¯è¡Œå…ƒç´ \n    // ç”ŸæˆèƒŒæ™¯è¡ŒåŠ¨ç”»\n    // ç”Ÿæˆç¿»è¯‘è¡Œå…ƒç´ \n    // çœç•¥éƒ¨åˆ†ä»£ç \n\n    // è¿”å›é€å­—åŠ¨ç”»\n    return line.words.map((word) => {\n      // ç”Ÿæˆé€å­—å…ƒç´ \n      const wordElement = document.createElement("span");\n      wordElement.innerText = word.text;\n      lineElement.appendChild(wordElement);\n\n      // ç”Ÿæˆé€å­—èƒŒæ™¯å…ƒç´ \n      // çœç•¥éƒ¨åˆ†ä»£ç \n\n      // ç”Ÿæˆé€å­—åŠ¨ç”»\n      const animateKeyframes = [\n        { clipPath: "inset(0 100% 0 0)" },\n        { clipPath: "inset(0 0 0 0)" },\n      ];\n      const animate = wordElement.animate(animateKeyframes, {\n        duration: word.duration.ms || 1,\n        easing: "linear",\n        fill: "backwards",\n      });\n      animate.pause();\n\n      return animate;\n    });\n  });\n};\n',
];
const copyCode = (index: number) => {
  const code = codeToCopy[index];
  navigator.clipboard.writeText(code);
};

const codeOpen = ref<boolean[]>([true, true]);
const toggleCodeOpen = (index: number) => {
  codeOpen.value[index] = !codeOpen.value[index];
};
</script>
